<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace= "poscustomer" >	
  
    <insert id="insertCustomer">
        /* poscustomer.insertCustomer */
		INSERT INTO CUSTOMER
		(
			MEMBERID
			,DEVICEID
			,CUSTOMERID
			,NAME
			,PHONENUMBER
			,TOTALSALES
			,ISINSTANT
			,TOTALCREDIT
			,TOTALDEPOSIT
			,ADDRESS
			,ISBLACK
			,ISDELIVER
			,PHONENUMBER2
			,BUILDINGID
			,ISDELETED
			,CREATIONDATE
			,MODIFICATIONDATE
		) VALUES (
			#{memberId}
			,#{deviceId}
			,#{customerId}
			,#{name}
            <choose>                
                <when test="phoneNumber != null and phoneNumber != '' ">
                    ,#{phoneNumber}
                </when>                
                <otherwise>
                    ,NULL
                </otherwise>                
            </choose>
            <choose>                
                <when test="totalSales != null and totalSales != '' ">
                    ,#{totalSales}
                </when>                
                <otherwise>
                    ,0
                </otherwise>                
            </choose>                       
            <choose>                
                <when test="isInstant != null and isInstant != '' ">
                    ,#{isInstant}
                </when>                
                <otherwise>
                    ,'N'
                </otherwise>                
            </choose> 
            <choose>                
                <when test="totalCredit != null and totalCredit != '' ">
                    ,#{totalCredit}
                </when>                
                <otherwise>
                    ,0
                </otherwise>                
            </choose> 
            <choose>                
                <when test="totalDeposit != null and totalDeposit != '' ">
                    ,#{totalDeposit}
                </when>                
                <otherwise>
                    ,0
                </otherwise>                
            </choose> 
            <choose>                
                <when test="address != null and address != '' ">
                    ,#{address}
                </when>                
                <otherwise>
                    ,NULL
                </otherwise>                
            </choose> 
            <choose>                
                <when test="isBlack != null and isBlack != '' ">
                    ,#{isBlack}
                </when>                
                <otherwise>
                    ,'N'
                </otherwise>                
            </choose> 
            <choose>                
                <when test="isDeliver != null and isDeliver != '' ">
                    ,#{isDeliver}
                </when>                
                <otherwise>
                    ,'N'
                </otherwise>                
            </choose> 
            <choose>                
                <when test="phoneNumber2 != null and phoneNumber2 != '' ">
                    ,#{phoneNumber2}
                </when>                
                <otherwise>
                    ,NULL
                </otherwise>                
            </choose>
            <choose>                
                <when test="buildingId != null and buildingId != '' ">
                    ,#{buildingId}
                </when>                
                <otherwise>
                    ,NULL
                </otherwise>                
            </choose>                                                        
            <choose>                
                <when test="isdeleted != null and isdeleted != '' ">
                    ,#{isdeleted}
                </when>                
                <otherwise>
                    ,'N'
                </otherwise>                
            </choose>
            <choose>                
                <when test="creationdate != null and creationdate != '' ">
                    ,#{creationdate}
                </when>                
                <otherwise>
                    ,SYSDATE
                </otherwise>                
            </choose>  
            <choose>                
                <when test="modificationdate != null and modificationdate != '' ">
                    ,#{modificationdate}
                </when>                
                <otherwise>
                    ,SYSDATE
                </otherwise>                
            </choose>              
            

		)     
    </insert>
    
    <select id="getCustomer" resultType="map">
        SELECT
			MEMBERID
			,DEVICEID
			,CUSTOMERID
			,NAME
			,PHONENUMBER
			,TOTALSALES
			,ISINSTANT
			,TOTALCREDIT
			,TOTALDEPOSIT
			,ADDRESS
			,ISBLACK
			,ISDELIVER
			,PHONENUMBER2
			,BUILDINGID
			,ISDELETED
			,CREATIONDATE
			,MODIFICATIONDATE 
		FROM
			CUSTOMER
		WHERE
			CUSTOMERID = #{customerId}
	 		<if test="isdeleted != null and isdeleted != ''">
				AND	ISDELETED = #{isdeleted}
			</if> 			    
        
    </select>
    
    <select id="getCustomerList" resultType="map">
        SELECT * FROM 
        ( 
			SELECT ROWNUM AS RNUM, Z.* FROM ( 
		        SELECT
					MEMBERID
					,DEVICEID
					,CUSTOMERID
					,NAME
					,PHONENUMBER
					,TOTALSALES
					,ISINSTANT
					,TOTALCREDIT
					,TOTALDEPOSIT
					,ADDRESS
					,ISBLACK
					,ISDELIVER
					,PHONENUMBER2
					,BUILDINGID
					,ISDELETED
					,CREATIONDATE
					,MODIFICATIONDATE 
				FROM
					CUSTOMER
				WHERE
					MEMBERID = #{memberId}
			 		<if test="isdeleted != null and isdeleted != ''">
						AND	ISDELETED = #{isdeleted}
					</if> 
			 		<if test="searchName != null and searchName != ''">
						AND	NAME LIKE '%${searchName}%'
					</if>
			 		<if test="isDeliver != null and isDeliver != ''">
						AND	ISDELIVER = #{isDeliver}
					</if>
			 		<if test="notNoName != null and notNoName.equals('Y')">
						AND	NAME IS NOT NULL AND NAME != ''
					</if>					
			 		<if test="isBlack != null and isBlack != ''">
						AND	ISBLACK = #{isBlack}
					</if>											
			 		<if test="initialLetter != null and initialLetter != ''">
						AND	NAME LIKE '${initialLetter}%'
					</if>
				ORDER BY ${orderBy} ${orderOption}	
			) Z
			WHERE
				ROWNUM <![CDATA[<]]>= (${page} * ${unitCount})	
		) 
		WHERE
			RNUM <![CDATA[>]]> ((${page} -1) * ${unitCount})      
    </select>
    
    <select id="getCustomerListCount" resultType="integer">
       
        SELECT
			COUNT(*) 
		FROM
			CUSTOMER
		WHERE
			MEMBERID = #{memberId}
	 		<if test="isdeleted != null and isdeleted != ''">
				AND	ISDELETED = #{isdeleted}
			</if> 
	 		<if test="searchName != null and searchName != ''">
				AND	NAME LIKE '%${searchName}%'
			</if>	
	 		<if test="isDeliver != null and isDeliver != ''">
				AND	ISDELIVER = #{isDeliver}
			</if>
	 		<if test="notNoName != null and notNoName.equals('Y')">
				AND	NAME IS NOT NULL AND NAME != ''
			</if>					
	 		<if test="isBlack != null and isBlack != ''">
				AND	ISBLACK = #{isBlack}
			</if>				
	 		<if test="initialLetter != null and initialLetter != ''">
				AND	NAME LIKE '${initialLetter}%'
			</if> 
    </select>    
    
 
</mapper>